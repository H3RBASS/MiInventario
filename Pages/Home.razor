@page "/"
@using MiInventario.Services
@inject ProductService productoService

<PageTitle>Dashboard</PageTitle>

<div class="min-h-screen w-full bg-gray-50 text-gray-800">
        <!-- Contenido principal -->
        <main class="flex-1 p-4 lg:p-6">
            <!-- Header -->
            <header class="bg-white rounded-xl shadow-sm p-4 lg:p-6 mb-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div>
                        <h1 class="text-xl lg:text-2xl font-bold text-gray-800">Dashboard de Inventario</h1>
                        <p class="text-gray-500 text-sm lg:text-base mt-1">Resumen general del stock y métricas</p>
                    </div>
                    <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
                        <button @onclick="AbrirModal" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 
                        focus:outline-none cursor-pointer transition duration-200 hover:scale-105">
                            + Nuevo Producto
                        </button>
                        @if (MostrarModal)
                        {
                            <!-- Fondo oscuro -->
                            <div class="fixed inset-0 bg-black/50 backdrop-blur-md flex items-center justify-center z-50">

                                
                                <!-- Ventana Mensaje de ALERTA -->
                                @if (AlertaVentana)
                                {
                                    <div style="position:fixed; top:20px; right:20px; background:red; color:white; padding:10px;"
                                        class="rounded-lg">
                                        <span>Rellena todos los campos</span>
                                        <button @onclick="() => AlertaVentana = false">X</button>
                                    </div>
                                }
                                <!-- Ventana -->
                                <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6">

                                    <h3 class="text-xl font-semibold mb-4 text-center">
                                        Añadir producto
                                    </h3>

                                    <EditForm Model="Productos" OnValidSubmit="Guardar">

                                    <EditForm/>
                                    <!-- Input -->
                                    <div class="flex flex-col gap-4">
                                        <div class="">
                                            <span>Nombre</span>
                                            <input
                                                type="text" required
                                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                @bind="NombreProducto"/>
                                        </div>

                                        <div>
                                            <span>Precio(Bs)</span>
                                            <input
                                            type="number" min="0" placeholder=""
                                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                @bind="PrecioProducto"/>
                                        </div>

                                        <div>
                                        <span>Cantidad</span>
                                        <input
                                            type="number" min="0" step="1"
                                            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            @bind="CantidadProducto"/>
                                        </div>

                                        <div>
                                        <span>Categoria</span>
                                        <select name="Opciones" id="1" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="Aseo Personal">Cuidado Personal</option>
                                            <option value="Cocina">Cocina</option>
                                            <option value="Enlatados">Enlatados</option>
                                            <option value="Limpieza">Limpieza</option>
                                            <option value="Plasticos">Plasticos</option>
                                            <option value="Reposteria">Reposteria</option>
                                            <option value="Abarrotes">Abarrotes</option>
                                        </select>
                                        </div>
                                    </div>
                                    <!-- Botones -->
                                    <div class="flex justify-end gap-3 mt-6">
                                        <button
                                            class="px-4 py-2 rounded-lg hover:bg-gray-300 cursor-pointer transition duration-200 hover:scale-105"
                                            @onclick="CerrarModal">
                                            Cancelar
                                        </button>

                                        <button
                                            class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 cursor-pointer transition duration-200 hover:scale-105"
                                            @onclick="Guardar">
                                            Guardar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </header>

            <!-- Grid de tarjetas KPI - Responsivo -->
            <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 lg:gap-6 mb-6">
                <!-- Total Stock Value -->
                <article class="bg-linear-to-br from-blue-500 to-blue-600 text-white rounded-xl shadow-lg p-4 lg:p-6">
                    <div class="flex justify-between items-start">
                        <div class="min-w-0">
                            <p class="text-blue-100 text-sm truncate">Valor Total</p>
                            <h2 class="text-2xl lg:text-3xl font-bold mt-2 truncate">@productoService.GetTotalPrice() @PrecioProducto Bs</h2>
                            <p class="text-blue-100 text-sm mt-2">+12.5% vs mes anterior</p>
                        </div>
                        <div class="bg-white/20 p-3 rounded-full shrink-0 ml-2">
                            <span class="text-xl lg:text-2xl" aria-hidden="true">💰</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-white/20">
                        <p class="text-sm truncate">Valor promedio por producto: $245</p>
                    </div>
                </article>

                <!-- Total Items -->
                <article class="bg-white rounded-xl shadow-lg p-4 lg:p-6">
                    <div class="flex justify-between items-start">
                        <div class="min-w-0">
                            <p class="text-gray-500 text-sm truncate">Productos Totales</p>
                            <h2 class="text-2xl lg:text-3xl font-bold text-gray-800 mt-2 truncate">@productoService.CountAllProducts()</h2>
                            <p class="text-green-600 text-sm font-medium mt-2">+45 productos este mes</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full shrink-0 ml-2">
                            <span class="text-xl lg:text-2xl text-green-600" aria-hidden="true">📦</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-100">
                        <div class="flex items-center">
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-green-500 h-2 rounded-full" style="width: 78%"></div>
                            </div>
                            <span class="text-sm text-gray-500 ml-2 whitespace-nowrap">78% stock óptimo</span>
                        </div>
                    </div>
                </article>

                <!-- Low Stock Alert -->
                <article class="bg-white rounded-xl shadow-lg p-4 lg:p-6">
                    <div class="flex justify-between items-start">
                        <div class="min-w-0">
                            <p class="text-gray-500 text-sm truncate">Stock Bajo</p>
                            <h2 class="text-2xl lg:text-3xl font-bold text-gray-800 mt-2 truncate">24</h2>
                            <p class="text-red-600 text-sm font-medium mt-2">Necesita reabastecimiento</p>
                        </div>
                        <div class="bg-red-100 p-3 rounded-full shrink-0 ml-2">
                            <span class="text-xl lg:text-2xl text-red-600" aria-hidden="true">⚠️</span>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="flex flex-wrap items-center text-sm gap-1">
                            <span class="text-gray-500">Producto crítico:</span>
                            <span class="font-medium truncate">Baterías AA</span>
                            <span class="ml-auto text-red-600 font-bold whitespace-nowrap">3 unidades</span>
                        </div>
                    </div>
                </article>

                <!-- Out of Stock -->
                <article class="bg-white rounded-xl shadow-lg p-4 lg:p-6 xl:col-span-1">
                    <div class="flex justify-between items-start mb-4">
                        <div class="min-w-0">
                            <p class="text-gray-500 text-sm truncate">Agotados</p>
                            <h2 class="text-2xl lg:text-3xl font-bold text-gray-800 mt-2 truncate">8</h2>
                        </div>
                        <div class="bg-orange-100 p-3 rounded-full shrink-0 ml-2">
                            <span class="text-xl lg:text-2xl text-orange-600" aria-hidden="true">🛑</span>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center p-2 hover:bg-gray-50 rounded">
                            <span class="text-sm truncate mr-2">Cables USB-C</span>
                            <span class="text-sm font-bold text-orange-600 whitespace-nowrap">0 unidades</span>
                        </div>
                        <div class="flex justify-between items-center p-2 hover:bg-gray-50 rounded">
                            <span class="text-sm truncate mr-2">Teclados Mecánicos</span>
                            <span class="text-sm font-bold text-orange-600 whitespace-nowrap">0 unidades</span>
                        </div>
                        <button class="w-full text-center text-blue-600 text-sm font-medium mt-2 hover:text-blue-800 focus:outline-none focus:underline">
                            Ver todos →
                        </button>
                    </div>
                </article>
            </section>

            <!-- Sección de gráfico y tabla - Responsivo -->
            <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- Stock Movement Chart -->
                <article class="bg-white rounded-xl shadow-lg p-4 lg:p-6">
                    <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                        <h3 class="text-lg font-bold text-gray-800">Movimiento de Stock (30 días)</h3>
                        <select 
                            class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option>Últimos 30 días</option>
                            <option>Últimos 90 días</option>
                            <option>Este año</option>
                        </select>
                    </header>
                    
                    <div class="h-48 lg:h-64 flex items-end gap-1 lg:gap-2 mt-4 lg:mt-8 px-2">
                        <!-- CORRECCIÓN: Sintaxis Blazor correcta para iteración -->
                        @{
                            var heights = new int[] { 80, 65, 90, 45, 70, 95, 60 };
                            var days = new string[] { "Lun", "Mar", "Mié", "Jue", "Vie", "Sáb", "Dom" };
                            
                            for (int i = 0; i < heights.Length; i++)
                            {
                                var height = heights[i];
                                var day = days[i];
                                var bgColor = i == 5 ? "#10b981" : "#3b82f6";
                                
                                <div class="flex-1 flex flex-col items-center">
                                    <div 
                                        class="w-3/4 lg:w-4/5 rounded-t-lg transition-all duration-300 hover:opacity-90"
                                        style="height: @(height)%; background-color: @bgColor">
                                    </div>
                                    <span class="text-xs text-gray-500 mt-2">@day</span>
                                </div>
                            }
                        }
                    </div>
                    
                    <footer class="mt-4 lg:mt-6 pt-4 border-t border-gray-100">
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div>
                                <p class="text-sm text-gray-500">Entradas</p>
                                <p class="font-bold text-lg">324</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Salidas</p>
                                <p class="font-bold text-lg">287</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Balance</p>
                                <p class="font-bold text-lg text-green-600">+37</p>
                            </div>
                        </div>
                    </footer>
                </article>

                <!-- Top Products -->
                <article class="bg-white rounded-xl shadow-lg p-4 lg:p-6">
                    <header class="mb-4 lg:mb-6">
                        <h3 class="text-lg font-bold text-gray-800">Productos</h3>
                    </header>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full min-w-125">
                            <thead>
                                <tr class="border-b border-gray-100">
                                    <th class="text-left py-3 text-gray-500 font-medium text-sm">Producto</th>
                                    <th class="text-left py-3 text-gray-500 font-medium text-sm">Categoría</th>
                                    <th class="text-left py-3 text-gray-500 font-medium text-sm">Stock</th>
                                    <th class="text-left py-3 text-gray-500 font-medium text-sm">Ventas (30d)</th>
                                    <th class="text-left py-3 text-gray-500 font-medium text-sm">Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Fila 1 -->
                                <tr class="border-b border-gray-50 hover:bg-gray-50 transition-colors duration-150">
                                    <td class="py-3">
                                        <div class="flex items-center min-w-0">
                                            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3 shrink-0">
                                                <span aria-hidden="true">🎧</span>
                                            </div>
                                            <span class="truncate">Auriculares BT</span>
                                        </div>
                                    </td>
                                    <td class="py-3 text-sm">Audio</td>
                                    <td class="py-3">
                                        <div class="flex items-center">
                                            <div class="w-16 lg:w-20 bg-gray-200 rounded-full h-2 mr-2">
                                                <div class="bg-green-500 h-2 rounded-full" style="width: 65%"></div>
                                            </div>
                                            <span class="text-sm whitespace-nowrap">42/65</span>
                                        </div>
                                    </td>
                                    <td class="py-3 font-bold text-sm">148</td>
                                    <td class="py-3">
                                        <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full whitespace-nowrap">
                                            Óptimo
                                        </span>
                                    </td>
                                </tr>
                                
                                <!-- Fila 2 -->
                                <tr class="border-b border-gray-50 hover:bg-gray-50 transition-colors duration-150">
                                    <td class="py-3">
                                        <div class="flex items-center min-w-0">
                                            <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-3 shrink-0">
                                                <span aria-hidden="true">🔋</span>
                                            </div>
                                            <span class="truncate">Power Bank 10K</span>
                                        </div>
                                    </td>
                                    <td class="py-3 text-sm">Accesorios</td>
                                    <td class="py-3">
                                        <div class="flex items-center">
                                            <div class="w-16 lg:w-20 bg-gray-200 rounded-full h-2 mr-2">
                                                <div class="bg-yellow-500 h-2 rounded-full" style="width: 30%"></div>
                                            </div>
                                            <span class="text-sm whitespace-nowrap">15/50</span>
                                        </div>
                                    </td>
                                    <td class="py-3 font-bold text-sm">112</td>
                                    <td class="py-3">
                                        <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full whitespace-nowrap">
                                            Bajo
                                        </span>
                                    </td>
                                </tr>
                                
                                <!-- Fila 3 -->
                                <tr class="hover:bg-gray-50 transition-colors duration-150">
                                    <td class="py-3">
                                        <div class="flex items-center min-w-0">
                                            <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3 shrink-0">
                                                <span aria-hidden="true">⌨️</span>
                                            </div>
                                            <span class="truncate">Teclado Inalámbrico</span>
                                        </div>
                                    </td>
                                    <td class="py-3 text-sm">Periféricos</td>
                                    <td class="py-3">
                                        <div class="flex items-center">
                                            <div class="w-16 lg:w-20 bg-gray-200 rounded-full h-2 mr-2">
                                                <div class="bg-red-500 h-2 rounded-full" style="width: 15%"></div>
                                            </div>
                                            <span class="text-sm whitespace-nowrap">3/20</span>
                                        </div>
                                    </td>
                                    <td class="py-3 font-bold text-sm">98</td>
                                    <td class="py-3">
                                        <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full whitespace-nowrap">
                                            Crítico
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </article>
            </section>
        </main>
    </div>